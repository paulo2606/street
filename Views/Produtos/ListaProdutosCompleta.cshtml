@model List<street.Models.Produto>

@{
    ViewData["Title"] = "Catalogo - SS Moda";
    ViewData["HideHeroSection"] = true;
}

<head>
    <link rel="stylesheet" href="~/css/catalogo.css">
</head>

<div class="catalog-content">
    <aside class="filters-sidebar">
        <h2>Filtros</h2>

        <div class="filter-group">
            <h3>Categorias</h3>
            <ul>
                <li><a href="#">Camisetas</a></li>
                <li><a href="#">Calças</a></li>
                <li><a href="#">Moletons</a></li>
                <li><a href="#">Jaquetas</a></li>
                <li><a href="#">Acessórios</a></li>
                <li><a href="#">Calçados</a></li>
            </ul>
        </div>

        <div class="filter-group">
            <h3>Tamanho</h3>
            <div class="size-options">
                <label><input type="checkbox" name="size" value="PP"> PP</label>
                <label><input type="checkbox" name="size" value="P"> P</label>
                <label><input type="checkbox" name="checkbox" value="M"> M</label>
                <label><input type="checkbox" name="size" value="G"> G</label>
                <label><input type="checkbox" name="size" value="GG"> GG</label>
            </div>
        </div>

        <div class="filter-group">
            <h3>Cor</h3>
            <div class="color-options">
                <span class="color-box black" data-color="black"></span>
                <span class="color-box white" data-color="white"></span>
                <span class="color-box red" data-color="red"></span>
                <span class="color-box blue" data-color="blue"></span>
                <span class="color-box green" data-color="green"></span>
                <span class="color-box gray" data-color="gray"></span>
            </div>
        </div>

        <div class="filter-group">
            <h3>Preço</h3>
            <input type="range" min="0" max="1500" value="750" class="price-range">
            <p>Valor: R$ <span id="price-value">750</span></p>
        </div>

        <div class="filter-group">
            <h3>Marca</h3>
            <select name="brand">
                <option value="">Todas</option>
                <option value="nike">Nike</option>
                <option value="adidas">Adidas</option>
                <option value="off-white">Off-White</option>
                <option value="fear-of-god">Fear of God</option>
                <option value="ss-moda">SS Moda</option>
            </select>
        </div>

        <button class="apply-filters">Aplicar Filtros</button>
        <button class="clear-filters">Limpar Filtros</button>

    </aside>
    <section class="products-section">
        <h1>Confira Nossos Produtos</h1>

        <p>
            <a asp-controller="Produtos" asp-action="CriarProduto" class="btn btn-primary">Adicionar Novo Produto</a>
        </p>

        <div class="products-grid">
            @if (Model != null && Model.Any())
            {
                foreach (var produto in Model)
                {
                    <div class="product-item">
                        <a asp-controller="Produtos" asp-action="DetalheProduto" asp-route-id="@produto.Id" class="product-link">
                            <img src="@produto.ImageUrl" alt="@produto.Nome" class="product-image-placeholder" style="width: 100%; height: 200px; object-fit: cover;">
                        </a>
                        <p class="product-name">@produto.Nome</p>
                        <p class="product-price">R$ @produto.Preco.ToString("N2")</p>

                        <div class="product-actions">
                            <a asp-controller="Produtos" asp-action="EditarProduto" asp-route-id="@produto.Id" class="btn btn-sm btn-info">Editar</a>
                            <button type="button" class="btn btn-sm btn-danger delete-product-btn" data-id="@produto.Id" data-name="@produto.Nome">Deletar</button>
                        </div>
                    </div>
                }
            }
            else
            {
                <p class="col-12 text-center">Nenhum produto disponível no momento. Por favor, adicione produtos ao banco de dados.</p>
            }
        </div>
    </section>

    @* Seu script original pode ir aqui, ou você pode ter um arquivo JS separado *@
    <script src="~/js/scriptListaProdutosCompleta.js"></script>

    @section Scripts {
        <script>
            // Novo script para a confirmação de exclusão
            document.addEventListener('DOMContentLoaded', function () {
                var deleteButtons = document.querySelectorAll('.delete-product-btn');

                deleteButtons.forEach(function (button) {
                    button.addEventListener('click', function () {
                        var productId = this.getAttribute('data-id');
                        var productName = this.getAttribute('data-name');

                        // Usa o pop-up de confirmação nativo do navegador
                        var confirmDelete = confirm(`Tem certeza que deseja excluir o produto "${productName}"?`);

                        if (confirmDelete) {
                            // Se o usuário confirmar, cria um formulário dinâmico e o envia
                            var form = document.createElement('form');
                            form.method = 'post';
                            form.action = `/Produtos/DeletarProdutoConfirmado/${productId}`; // Aponta para a ação POST

                            var antiForgeryInput = document.createElement('input');
                            antiForgeryInput.type = 'hidden';
                            antiForgeryInput.name = '__RequestVerificationToken';
                            // Preenche o token anti-falsificação (necessário para [ValidateAntiForgeryToken])
                            antiForgeryInput.value = '@Html.AntiForgeryToken()'.match(/value="([^"]*)"/)[1];

                            form.appendChild(antiForgeryInput);
                            document.body.appendChild(form);
                            form.submit();
                        }
                    });
                });
            });
        </script>
    }
</div>